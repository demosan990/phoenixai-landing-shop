<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”¼ë‹‰ìŠ¤AI Agent íŒ©í† ë¦¬ | 2025 í•˜ë°˜ê¸° ì˜¤í”ˆ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ======= ì›ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€ ======= */
        :root {
            --bg: #0b1020;
            --panel: rgba(255,255,255,0.06);
            --panel-2: rgba(255,255,255,0.10);
            --text: rgba(255,255,255,0.92);
            --muted: rgba(255,255,255,0.70);
            --line: rgba(255,255,255,0.12);
            --accent: #82e9ff;
            --accent2: #a3ff6b;
            --danger: #ff6b6b;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, Arial;
            background: radial-gradient(1200px 600px at 70% 15%, rgba(130,233,255,0.10), transparent 60%),
                        radial-gradient(900px 500px at 20% 20%, rgba(163,255,107,0.08), transparent 60%),
                        radial-gradient(800px 400px at 40% 80%, rgba(255,255,255,0.05), transparent 60%),
                        var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        a { color: inherit; text-decoration: none; }
        .container { width: min(1100px, calc(100% - 40px)); margin: 0 auto; }

        header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(12px);
            background: rgba(11,16,32,0.70);
            border-bottom: 1px solid var(--line);
        }
        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 0;
        }
        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .brand .logo {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(130,233,255,0.8), rgba(163,255,107,0.55));
            box-shadow: 0 10px 26px rgba(0,0,0,0.45);
        }
        .brand .title {
            line-height: 1.05;
        }
        .brand .title .top {
            font-family: "Cormorant Garamond";
            font-weight: 700;
            letter-spacing: 0.2px;
            font-size: 18px;
        }
        .brand .title .sub {
            font-size: 12px;
            color: var(--muted);
            letter-spacing: 0.2px;
        }

        nav { display: flex; align-items: center; gap: 14px; }
        .nav-link {
            font-size: 13px;
            color: var(--muted);
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid transparent;
        }
        .nav-link:hover { border-color: var(--line); color: var(--text); background: rgba(255,255,255,0.04); }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid var(--line);
            color: var(--text);
            background: rgba(255,255,255,0.05);
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
        }
        .btn:hover { background: rgba(255,255,255,0.08); }
        .btn.primary {
            border: 1px solid rgba(130,233,255,0.35);
            background: linear-gradient(135deg, rgba(130,233,255,0.18), rgba(163,255,107,0.12));
        }
        .btn.danger {
            border: 1px solid rgba(255,107,107,0.35);
            background: rgba(255,107,107,0.12);
        }

        .hero {
            padding: 56px 0 30px;
        }
        .hero-grid {
            display: grid;
            grid-template-columns: 1.3fr 0.7fr;
            gap: 20px;
            align-items: stretch;
        }
        @media (max-width: 980px) {
            .hero-grid { grid-template-columns: 1fr; }
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: 18px;
            padding: 18px;
            box-shadow: 0 16px 60px rgba(0,0,0,0.34);
        }
        .hero h1 {
            margin: 0 0 10px;
            font-size: 34px;
            letter-spacing: -0.2px;
        }
        .hero p {
            margin: 0 0 18px;
            color: var(--muted);
            line-height: 1.7;
        }
        .pill-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .pill {
            border: 1px solid var(--line);
            background: rgba(255,255,255,0.04);
            color: rgba(255,255,255,0.86);
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 999px;
        }

        .mini {
            display: grid;
            gap: 10px;
        }
        .mini .stat {
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 12px;
        }
        .mini .stat .k { font-size: 12px; color: var(--muted); }
        .mini .stat .v { font-size: 16px; font-weight: 800; margin-top: 4px; }

        .section { padding: 26px 0; }
        .section h2 { margin: 0 0 12px; font-size: 22px; }
        .muted { color: var(--muted); }

        /* Footer admin buttons */
        .footer-admin-btns {
            position: fixed;
            bottom: 18px;
            right: 18px;
            display: flex;
            gap: 10px;
            z-index: 60;
            opacity: 0;
            pointer-events: none;
            transform: translateY(8px);
            transition: all .2s ease;
        }
        .footer-admin-btns.admin-visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        /* Overlay pages */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 18px;
            z-index: 80;
        }
        .overlay.active { display: flex; }
        .overlay .panel {
            width: min(980px, 100%);
            max-height: min(86vh, 920px);
            overflow: auto;
            background: rgba(11,16,32,0.92);
            border: 1px solid var(--line);
            border-radius: 18px;
            padding: 18px;
            box-shadow: 0 18px 70px rgba(0,0,0,0.60);
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .panel-header h3 { margin: 0; font-size: 18px; }
        .close-x {
            width: 38px; height: 38px;
            border-radius: 12px;
            border: 1px solid var(--line);
            background: rgba(255,255,255,0.05);
            cursor: pointer;
            font-size: 16px;
            color: var(--text);
        }
        .close-x:hover { background: rgba(255,255,255,0.08); }

        table { width: 100%; border-collapse: collapse; }
        th, td {
            border-bottom: 1px solid var(--line);
            padding: 10px 8px;
            font-size: 13px;
            color: rgba(255,255,255,0.88);
        }
        th { text-align: left; color: rgba(255,255,255,0.75); font-weight: 700; }

        .status-message {
            margin-top: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid var(--line);
            background: rgba(255,255,255,0.04);
            display: none;
            font-size: 13px;
        }
        .status-success { border-color: rgba(163,255,107,0.35); }
        .status-error { border-color: rgba(255,107,107,0.35); }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        @media (max-width: 860px){ .form-row{ grid-template-columns: 1fr; } }
        label { display: block; margin: 10px 0 6px; color: rgba(255,255,255,0.80); font-size: 13px; }
        input, select, textarea {
            width: 100%;
            border-radius: 12px;
            border: 1px solid var(--line);
            background: rgba(255,255,255,0.04);
            color: rgba(255,255,255,0.92);
            padding: 10px 12px;
            outline: none;
        }
        textarea { min-height: 90px; resize: vertical; }
        .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
        .divider { height: 1px; background: var(--line); margin: 14px 0; }

        /* === ì›ë³¸ ë‚´ìš© ë === */
    </style>
</head>
<body>

<header>
    <div class="container header-inner">
        <div class="brand">
            <div class="logo"></div>
            <div class="title">
                <div class="top">PhoenixAI Agent Factory</div>
                <div class="sub">AI ì—ì´ì „íŠ¸ & ìë™í™” í”Œë«í¼ Â· 2025 í•˜ë°˜ê¸° ì˜¤í”ˆ</div>
            </div>
        </div>
        <nav>
            <a class="nav-link" href="#about">ì†Œê°œ</a>
            <a class="nav-link" href="#service">ì„œë¹„ìŠ¤</a>
            <a class="nav-link" href="#faq">FAQ</a>
            <button class="btn primary" id="headerLoginBtn" onclick="toggleHeaderLogin()">ë¡œê·¸ì¸</button>
        </nav>
    </div>
</header>

<main>
    <section class="hero">
        <div class="container hero-grid">
            <div class="card">
                <h1>AI ì—ì´ì „íŠ¸ ìš´ì˜, ì´ì œ â€œì‚¬ì´íŠ¸â€ì—ì„œ ëë‚´ì„¸ìš”</h1>
                <p>
                    í”¼ë‹‰ìŠ¤AI Agent íŒ©í† ë¦¬ëŠ” ì •ì  ì›¹ì‚¬ì´íŠ¸ì—ì„œë„ ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ìš´ì˜ í™”ë©´(ê³ ê°ê´€ë¦¬/AIì±—ë´‡ê´€ë¦¬)ì„ ì œê³µí•˜ê³ ,
                    AI API ì„¤ì •ì„ Supabaseì— ì €ì¥í•˜ì—¬ ë¸Œë¼ìš°ì €ì— í‚¤ë¥¼ ë‚¨ê¸°ì§€ ì•ŠëŠ” êµ¬ì¡°ë¡œ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div class="pill-row">
                    <div class="pill">Supabase Auth ë¡œê·¸ì¸</div>
                    <div class="pill">ê´€ë¦¬ì ì „ìš© ë©”ë‰´</div>
                    <div class="pill">API í‚¤: Supabase DB ì €ì¥</div>
                    <div class="pill">ì •ì  ì‚¬ì´íŠ¸ ìœ ì§€</div>
                </div>
            </div>

            <div class="card mini">
                <div class="stat">
                    <div class="k">ìš´ì˜ ëª¨ë“œ</div>
                    <div class="v">AIì±—ë´‡ê´€ë¦¬ / ê³ ê°ê´€ë¦¬</div>
                </div>
                <div class="stat">
                    <div class="k">ë°°í¬</div>
                    <div class="v">Netlify (ì •ì )</div>
                </div>
                <div class="stat">
                    <div class="k">ì¸ì¦</div>
                    <div class="v">Supabase Auth</div>
                </div>
            </div>
        </div>
    </section>

    <section id="about" class="section">
        <div class="container">
            <h2>ì†Œê°œ</h2>
            <p class="muted">
                (ì›ë³¸ ë‚´ìš© ìœ ì§€) â€” ì—¬ê¸°ì— ê¸°ì¡´ ì†Œê°œ í…ìŠ¤íŠ¸ê°€ ë“¤ì–´ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.
            </p>
        </div>
    </section>

    <section id="service" class="section">
        <div class="container">
            <h2>ì„œë¹„ìŠ¤</h2>
            <p class="muted">(ì›ë³¸ ë‚´ìš© ìœ ì§€)</p>
        </div>
    </section>

    <section id="faq" class="section">
        <div class="container">
            <h2>FAQ</h2>
            <p class="muted">(ì›ë³¸ ë‚´ìš© ìœ ì§€)</p>
        </div>
    </section>
</main>

<!-- Footer admin buttons (ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œë§Œ ë³´ì´ê²Œ) -->
<div class="footer-admin-btns" id="footerAdminBtns">
    <button class="btn" onclick="loginChatbotAdmin()">AIì±—ë´‡ ê´€ë¦¬</button>
    <button class="btn" onclick="showAdminPage()">ê³ ê° ê´€ë¦¬</button>
</div>

<!-- ê³ ê° ê´€ë¦¬ overlay -->
<div class="overlay" id="adminPage">
    <div class="panel">
        <div class="panel-header">
            <h3>ê³ ê° ê´€ë¦¬</h3>
            <button class="close-x" onclick="closeAdminPage()">âœ•</button>
        </div>

        <div class="divider"></div>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="divider"></div>

        <table>
            <thead>
                <tr>
                    <th>ì ‘ìˆ˜ì‹œê°„</th>
                    <th>ì´ë¦„</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ìœ ì…ê²½ë¡œ</th>
                    <th>ìš”ì²­ë‚´ìš©</th>
                </tr>
            </thead>
            <tbody id="adminTableBody"></tbody>
        </table>
    </div>
</div>

<!-- ì±—ë´‡ ê´€ë¦¬ overlay -->
<div class="overlay" id="chatbotAdminPage">
    <div class="panel">
        <div class="panel-header">
            <h3>AIì±—ë´‡ ê´€ë¦¬</h3>
            <button class="close-x" onclick="closeChatbotAdminPage()">âœ•</button>
        </div>

        <p class="muted">API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥í•˜ì§€ ì•Šê³  Supabase(DB)ì— ì €ì¥ë©ë‹ˆë‹¤.</p>

        <div class="divider"></div>

        <div class="form-row">
            <div>
                <label>ChatGPT ëª¨ë¸</label>
                <select id="chatgptModel" onchange="handleFinetuningInput('chatgpt')">
                    <option value="">ì„ íƒ</option>
                    <option value="gpt-4o">gpt-4o</option>
                    <option value="gpt-4.1">gpt-4.1</option>
                    <option value="finetuning">íŒŒì¸íŠœë‹(ì§ì ‘ì…ë ¥)</option>
                </select>

                <div id="chatgptFinetuningGroup" style="display:none; margin-top:10px;">
                    <label>íŒŒì¸íŠœë‹ ëª¨ë¸ëª…</label>
                    <input id="chatgptFinetuningModel" placeholder="ì˜ˆ: ft:gpt-4o:your-org:your-model" />
                </div>

                <label>ChatGPT API Key</label>
                <input id="chatgptApiKey" placeholder="sk-..." />
            </div>

            <div>
                <label>Gemini ëª¨ë¸</label>
                <select id="geminiModel">
                    <option value="">ì„ íƒ</option>
                    <option value="gemini-1.5-pro">gemini-1.5-pro</option>
                    <option value="gemini-1.5-flash">gemini-1.5-flash</option>
                </select>
                <label>Gemini API Key</label>
                <input id="geminiApiKey" placeholder="AIza..." />

                <label style="margin-top:14px;">Claude ëª¨ë¸</label>
                <select id="claudeModel">
                    <option value="">ì„ íƒ</option>
                    <option value="claude-3.5-sonnet">claude-3.5-sonnet</option>
                    <option value="claude-3-opus">claude-3-opus</option>
                </select>
                <label>Claude API Key</label>
                <input id="claudeApiKey" placeholder="sk-ant-..." />
            </div>
        </div>

        <div class="actions">
            <button class="btn primary" onclick="saveApiSettings()">ì €ì¥</button>
            <button class="btn" onclick="testApiConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸(ë°ëª¨)</button>
            <button class="btn danger" onclick="resetApiSettings()">ì´ˆê¸°í™”</button>
            <button class="btn danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div id="apiStatus" class="status-message"></div>
    </div>
</div>

<!-- âœ… Supabase ì„¤ì • + SDK ë¡œë“œ -->
<script>
    // âœ… Supabase ì„¤ì •ê°’ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (Supabase Project Settings â†’ Data API / API Keys)
    // - SUPABASE_URL: Project URL (https://xxxx.supabase.co)
    // - SUPABASE_ANON_KEY: anon public key
    window.APP_CONFIG = {
        SUPABASE_URL: "PASTE_YOUR_SUPABASE_URL_HERE",
        SUPABASE_ANON_KEY: "PASTE_YOUR_SUPABASE_ANON_KEY_HERE"
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
        // â•â•â•â•â•â•â• DATA STORE â•â•â•â•â•â•â•
        const applicationData = [];

        // âœ… Supabase client ì´ˆê¸°í™”
        let supabase = null;

        (function initSupabase(){
            const cfg = window.APP_CONFIG || {};
            if (!cfg.SUPABASE_URL || cfg.SUPABASE_URL.includes("PASTE_") || !cfg.SUPABASE_ANON_KEY || cfg.SUPABASE_ANON_KEY.includes("PASTE_")) {
                console.warn("[Supabase] SUPABASE_URL / SUPABASE_ANON_KEY ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. window.APP_CONFIG ê°’ì„ í™•ì¸í•˜ì„¸ìš”.");
                return;
            }
            supabase = window.supabase.createClient(cfg.SUPABASE_URL, cfg.SUPABASE_ANON_KEY);
        })();

        // UI flags
        let chatbotOpen = false;
        let apiSettings = {
            chatgpt: { apiKey: '', model: '', enabled: false },
            gemini: { apiKey: '', model: '', enabled: false },
            claude: { apiKey: '', model: '', enabled: false },
            activeProvider: ''
        };

        // âœ… API ì„¤ì •ì€ ë” ì´ìƒ ë¸Œë¼ìš°ì €(localStorage)ì— ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        //    'AIì±—ë´‡ê´€ë¦¬'ì—ì„œ Supabase(DB)ë¡œ ë¡œë“œ/ì €ì¥ë©ë‹ˆë‹¤.

        let adminMenuLoggedIn = false;

        // âœ… ë¡œê·¸ì¸ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬ì ë©”ë‰´/ë²„íŠ¼ í‘œì‹œë¥¼ ë™ê¸°í™”
        async function refreshAdminUI() {
            if (!supabase) return;
            const { data: { session } } = await supabase.auth.getSession();

            // í—¤ë” ë¡œê·¸ì¸ ë²„íŠ¼ í…ìŠ¤íŠ¸
            const headerBtn = document.getElementById('headerLoginBtn');
            if (headerBtn) headerBtn.textContent = session ? 'ë¡œê·¸ì•„ì›ƒ' : 'ë¡œê·¸ì¸';

            // í‘¸í„° ê´€ë¦¬ì ë²„íŠ¼ ê·¸ë£¹ í‘œì‹œ(ê¸°ì¡´ CSS: .admin-visible)
            const footerAdmin = document.getElementById('footerAdminBtns');
            if (footerAdmin) {
                if (session) footerAdmin.classList.add('admin-visible');
                else footerAdmin.classList.remove('admin-visible');
            }

            adminMenuLoggedIn = !!session;

            // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ê´€ë¦¬ì íŒì—… ë‹«ê¸°
            if (!session) {
                document.getElementById('adminPage')?.classList.remove('active');
                document.getElementById('chatbotAdminPage')?.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // ì´ˆê¸° ë¡œë“œ + ì„¸ì…˜ ë³€í™” ê°ì§€
        (async () => {
            if (!supabase) return;
            await refreshAdminUI();
            supabase.auth.onAuthStateChange(async () => {
                await refreshAdminUI();
            });
        })();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // âœ… Supabaseì— API ì„¤ì • ì €ì¥/ë¡œë“œ (ë¸Œë¼ìš°ì € ì €ì¥ ì œê±°)
        // â”€ DB í…Œì´ë¸”: public.api_settings (user_id, provider, model, api_key)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadApiSettingsFromSupabase() {
            if (!supabase) return;

            const { data: { session } } = await supabase.auth.getSession();
            if (!session) return;

            const { data, error } = await supabase
                .from('api_settings')
                .select('provider, model, api_key')
                .eq('user_id', session.user.id);

            if (error) {
                showStatus('apiStatus', 'âŒ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
                return;
            }

            // ì´ˆê¸°í™”
            apiSettings = {
                chatgpt: { apiKey: '', model: '', enabled: false },
                gemini: { apiKey: '', model: '', enabled: false },
                claude: { apiKey: '', model: '', enabled: false },
                activeProvider: ''
            };

            const byProvider = { chatgpt: null, gemini: null, claude: null };
            (data || []).forEach(r => { byProvider[r.provider] = r; });

            // UIì— ë°˜ì˜ + ë©”ëª¨ë¦¬ì— ë°˜ì˜
            if (byProvider.chatgpt) {
                apiSettings.chatgpt = {
                    apiKey: byProvider.chatgpt.api_key || '',
                    model: byProvider.chatgpt.model || '',
                    enabled: !!(byProvider.chatgpt.api_key && byProvider.chatgpt.model)
                };
                // finetuning ë¶„ê¸° ì²˜ë¦¬: ëª¨ë¸ëª…ì´ dropdown ì˜µì…˜ì— ì—†ìœ¼ë©´ finetuningìœ¼ë¡œ ë‘ê³  ì…ë ¥ì¹¸ì— ë„£ìŒ
                const sel = document.getElementById('chatgptModel');
                const ft = document.getElementById('chatgptFinetuningModel');
                if (sel) {
                    const hasOption = Array.from(sel.options).some(o => o.value === apiSettings.chatgpt.model);
                    if (hasOption) {
                        sel.value = apiSettings.chatgpt.model;
                        if (ft) ft.value = '';
                        document.getElementById('chatgptFinetuningGroup').style.display = 'none';
                    } else {
                        sel.value = 'finetuning';
                        if (ft) ft.value = apiSettings.chatgpt.model;
                        document.getElementById('chatgptFinetuningGroup').style.display = 'block';
                    }
                }
                const keyEl = document.getElementById('chatgptApiKey');
                if (keyEl) keyEl.value = apiSettings.chatgpt.apiKey;
            }

            if (byProvider.gemini) {
                apiSettings.gemini = {
                    apiKey: byProvider.gemini.api_key || '',
                    model: byProvider.gemini.model || '',
                    enabled: !!(byProvider.gemini.api_key && byProvider.gemini.model)
                };
                const sel = document.getElementById('geminiModel');
                if (sel) sel.value = apiSettings.gemini.model || '';
                const keyEl = document.getElementById('geminiApiKey');
                if (keyEl) keyEl.value = apiSettings.gemini.apiKey;
            }

            if (byProvider.claude) {
                apiSettings.claude = {
                    apiKey: byProvider.claude.api_key || '',
                    model: byProvider.claude.model || '',
                    enabled: !!(byProvider.claude.api_key && byProvider.claude.model)
                };
                const sel = document.getElementById('claudeModel');
                if (sel) sel.value = apiSettings.claude.model || '';
                const keyEl = document.getElementById('claudeApiKey');
                if (keyEl) keyEl.value = apiSettings.claude.apiKey;
            }

            let activeCount = [apiSettings.chatgpt, apiSettings.gemini, apiSettings.claude].filter(a => a.enabled).length;
            if (activeCount === 0) showStatus('apiStatus', 'â„¹ï¸ ì•„ì§ ì €ì¥ëœ API ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.', 'success');
            else showStatus('apiStatus', `âœ… Supabaseì—ì„œ ${activeCount}ê°œì˜ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
        }

        async function saveApiSettingsToSupabase() {
            if (!supabase) return;

            const { data: { session } } = await supabase.auth.getSession();
            if (!session) { showStatus('apiStatus', 'âŒ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error'); return; }

            const rows = [
                { user_id: session.user.id, provider: 'chatgpt', model: apiSettings.chatgpt.model || '', api_key: apiSettings.chatgpt.apiKey || '' },
                { user_id: session.user.id, provider: 'gemini', model: apiSettings.gemini.model || '', api_key: apiSettings.gemini.apiKey || '' },
                { user_id: session.user.id, provider: 'claude', model: apiSettings.claude.model || '', api_key: apiSettings.claude.apiKey || '' }
            ];

            const { error } = await supabase
                .from('api_settings')
                .upsert(rows, { onConflict: 'user_id,provider' });

            if (error) {
                showStatus('apiStatus', 'âŒ ì €ì¥ ì‹¤íŒ¨: ' + error.message, 'error');
                return;
            }
            showStatus('apiStatus', 'âœ… Supabaseì— ì €ì¥ ì™„ë£Œ', 'success');
        }

        // ======= ë¡œê·¸ì¸ ë²„íŠ¼ (Supabase Auth) =======
        function toggleHeaderLogin() {
            if (!supabase) { alert('Supabase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. window.APP_CONFIGë¥¼ í™•ì¸í•˜ì„¸ìš”.'); return; }

            supabase.auth.getSession().then(async ({ data: { session } }) => {
                if (session) {
                    await supabase.auth.signOut();
                    await refreshAdminUI();
                    return;
                }

                const email = prompt('ê´€ë¦¬ì ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:', 'phoenixai.sw@gmail.com');
                if (email === null) return;
                const pw = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', '');
                if (pw === null) return;

                const { error } = await supabase.auth.signInWithPassword({
                    email: String(email).trim(),
                    password: String(pw)
                });

                if (error) {
                    alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
                    return;
                }

                await refreshAdminUI();
                alert('ë¡œê·¸ì¸ ì„±ê³µ');
            });
        }

        // ======= ê³ ê° ê´€ë¦¬ ì˜¤í”ˆ(ì„¸ì…˜ í•„ìš”) =======
        async function showAdminPage() {
            if (!supabase) { alert('Supabase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. window.APP_CONFIGë¥¼ í™•ì¸í•˜ì„¸ìš”.'); return; }
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) { alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

            document.getElementById('adminPage').classList.add('active');
            document.body.style.overflow = 'hidden';
            updateAdminTable();
        }

        function closeAdminPage() {
            document.getElementById('adminPage').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ======= ì±—ë´‡ ê´€ë¦¬ ì˜¤í”ˆ(ì„¸ì…˜ í•„ìš”) + Supabase ë¡œë“œ =======
        async function loginChatbotAdmin() {
            if (!supabase) { alert('Supabase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. window.APP_CONFIGë¥¼ í™•ì¸í•˜ì„¸ìš”.'); return; }
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) { alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

            document.getElementById('chatbotAdminPage').classList.add('active');
            document.body.style.overflow = 'hidden';

            await loadApiSettingsFromSupabase();
        }

        function closeChatbotAdminPage() {
            document.getElementById('chatbotAdminPage').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ======= ë¡œê·¸ì•„ì›ƒ =======
        async function logout() {
            if (!supabase) return;
            await supabase.auth.signOut();
            await refreshAdminUI();
            closeAdminPage();
            closeChatbotAdminPage();
        }

        // ======= ê³ ê° ë°ì´í„°(ì›ë³¸: ë°ëª¨ ë°ì´í„° ìœ ì§€) =======
        applicationData.push({
            timestamp: '2025-06-10 14:30:25', name: 'ê¹€ì² ìˆ˜', phone: '010-1234-5678',
            email: 'kim@example.com', source: 'SNS', automation: 'ê³ ê° ë¬¸ì˜ ì‘ë‹µ ìë™í™” ë° ì´ë©”ì¼ ë§ˆì¼€íŒ… ì‹œìŠ¤í…œ êµ¬ì¶•'
        });
        applicationData.push({
            timestamp: '2025-06-11 09:11:02', name: 'ë°•ì˜í¬', phone: '010-9999-0000',
            email: 'park@example.com', source: 'ì§€ì¸ì¶”ì²œ', automation: 'ê²¬ì ì„œ ìë™ ìƒì„± ë° ë°œì†¡ ì‹œìŠ¤í…œ'
        });

        function updateAdminTable() {
            const tbody = document.getElementById('adminTableBody');
            tbody.innerHTML = '';
            applicationData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.timestamp}</td>
                    <td>${row.name}</td>
                    <td>${row.phone}</td>
                    <td>${row.email}</td>
                    <td>${row.source}</td>
                    <td>${row.automation}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function exportCSV() {
            const headers = ['timestamp','name','phone','email','source','automation'];
            const lines = [
                headers.join(','),
                ...applicationData.map(r => headers.map(h => `"${String(r[h] ?? '').replaceAll('"','""')}"`).join(','))
            ];
            const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'customers.csv';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }

        // ======= API Settings =======
        async function saveApiSettings() {
            const chatgptModel = document.getElementById('chatgptModel').value;
            const chatgptFinetuningModel = document.getElementById('chatgptFinetuningModel').value.trim();
            const chatgptApiKey = document.getElementById('chatgptApiKey').value.trim();
            const geminiModel = document.getElementById('geminiModel').value;
            const geminiApiKey = document.getElementById('geminiApiKey').value.trim();
            const claudeModel = document.getElementById('claudeModel').value;
            const claudeApiKey = document.getElementById('claudeApiKey').value.trim();

            let finalChatGPTModel = chatgptModel;
            if (chatgptModel === 'finetuning' && chatgptFinetuningModel) finalChatGPTModel = chatgptFinetuningModel;

            apiSettings.chatgpt = { model: finalChatGPTModel, apiKey: chatgptApiKey, enabled: !!(finalChatGPTModel && chatgptApiKey) };
            apiSettings.gemini = { model: geminiModel, apiKey: geminiApiKey, enabled: !!(geminiModel && geminiApiKey) };
            apiSettings.claude = { model: claudeModel, apiKey: claudeApiKey, enabled: !!(claudeModel && claudeApiKey) };

            let activeCount = [apiSettings.chatgpt, apiSettings.gemini, apiSettings.claude].filter(a => a.enabled).length;
            if (activeCount === 0) {
                showStatus('apiStatus', 'âŒ ìµœì†Œ í•˜ë‚˜ì˜ AI ëª¨ë¸ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // âœ… Supabase(DB)ì— ì €ì¥ (ë¸Œë¼ìš°ì € ì €ì¥ ì œê±°)
            await saveApiSettingsToSupabase();

            showStatus('apiStatus', `âœ… ${activeCount}ê°œì˜ AI ëª¨ë¸ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function testApiConnection() {
            showStatus('apiStatus', 'ğŸ”„ API ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'success');
            setTimeout(() => showStatus('apiStatus', 'ğŸ‰ API ì—°ê²° í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'), 1500);
        }

        function resetApiSettings() {
            if (confirm('ëª¨ë“  API ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                ['chatgptModel','chatgptApiKey','chatgptFinetuningModel','geminiModel','geminiApiKey','claudeModel','claudeApiKey']
                    .forEach(id => document.getElementById(id).value = '');
                document.getElementById('chatgptFinetuningGroup').style.display = 'none';
                apiSettings = { chatgpt: { apiKey:'',model:'',enabled:false }, gemini: { apiKey:'',model:'',enabled:false }, claude: { apiKey:'',model:'',enabled:false }, activeProvider:'' };

                // âœ… ì´ˆê¸°í™” í›„ Supabaseì—ë„ ë°˜ì˜
                if (supabase) { saveApiSettingsToSupabase(); }

                showStatus('apiStatus', 'âœ… ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            }
        }

        function handleFinetuningInput(provider) {
            const sel = document.getElementById(`${provider}Model`);
            const grp = document.getElementById(`${provider}FinetuningGroup`);
            if (!grp || !sel) return;
            grp.style.display = sel.value === 'finetuning' ? 'block' : 'none';
        }

        function showStatus(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = `status-message status-${type}`;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        // Admin shortcut
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.altKey && e.key === 'a') { e.preventDefault(); showAdminPage(); }
        });
</script>

</body>
</html>